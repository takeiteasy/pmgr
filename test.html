<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>test</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
    }
    #main {
      width: 100%;
      height: 100%;
    }
    .cont {
      width: calc(50% - 12px);
      height: 100%;
      border: 1px solid black;
      padding: 5px;
      overflow-y: scroll;
    }
    #left {
      float: left;
    }
    #right {
      float: right;
    }
  </style>
  <link rel="stylesheet" href="public/highlight.css">
  <script type="text/javascript" src="public/highlight.js"></script>
  <script type="text/javascript">hljs.initHighlightingOnLoad();</script>
  <link rel="stylesheet" href="public/katex.css">
  <script type="text/javascript" src="public/katex.js"></script>
  <script type="text/javascript" src="public/md.js"></script>
  <script type="text/javascript" src="public/emoji.js"></script>
  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function(e) {
      let input  = document.getElementById("left");
      let output = document.getElementById("right");
      input.addEventListener("input", function() { // Text changed event
        let src = emojify(input.innerText); // Convert emoji short codes
        output.innerHTML = md(src); // Convert markdown to HTML
        
        // Highlight code blocks
        let code_blocks = document.querySelectorAll('pre code');
        for (let i = 0; i < code_blocks.length; i++)
          hljs.highlightBlock(code_blocks[i]);
        // Convert math blocks
        let math_blocks = document.querySelectorAll('div.lang-math');
        for (let i = 0; i < math_blocks.length; i++)
          math_blocks[i].innerHTML = katex.renderToString(math_blocks[i].innerHTML);
      });
      input.addEventListener("paste", function(e) { // Paste event
        e.stopPropagation();
        e.preventDefault();
        // Prevent pasting HTML
        window.document.execCommand('insertText', false, (e.clipboardData || window.clipboardData).getData('Text'));
      });
    });
  </script>
</head>
<body>
  <div id="main">
    <div class="cont" id="left" contenteditable="true"></div>
    <div class="cont" id="right"></div>
  </div>
</body>
</html>
